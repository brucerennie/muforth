( This file is part of muforth: https://muforth.nimblemachines.com/

  Copyright 2002-2023 David Frech. (Read the LICENSE for details.)


-d mega324

ld! target/AVR/build.mu4

 "ff_d0_e2  fuses !  ( SPIEN, EESAVE, bootsz 00, reset to bootloader; SUT 10, 8M RC clk)
%1110_1111  locks !  ( protect bootloader; leave lock bits unprogrammed)

app
ld target/AVR/app-prelude.mu4

boot
1 vectors allot  ( leave room for reset vector)
ld target/AVR/test/iic-next-to-serial.mu4
ld target/AVR/chat-serial.mu4

( This will override the boot RESET handler so that it [somehow] sets up
  both chats side by side!)
ld target/AVR/test/start-both-chats.mu4

( Put this *after* the chat code so that the RAM variables allocated by
  heart don't offset the variables for the tasks - esp the status log.)

app
ld target/AVR/heart.mu4

RESET handler  heart-init rjmp  ;c

hooks application-run-hook
label run-heart  heart-task rjmp  ;c

hooks application-stop-hook
label stop-heart  cli  ret  ;c

boot
